version: '3.8'

services:
  # نظام الموارد البشرية الذكي - Smart HR System
  hr-system:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hr-ml-system
    ports:
      - "1234:8000"
    volumes:
      # ربط المجلدات للحفاظ على البيانات - Mount volumes to persist data
      - ./data:/app/data
      - ./models:/app/models
      - ./logs:/app/logs
      - ./policies:/app/policies
      - ./employees:/app/employees
    environment:
      # متغيرات البيئة - Environment variables
      - PYTHONUNBUFFERED=1
      - DEFAULT_LANGUAGE=ar
      # إعدادات SQL Server - SQL Server Settings
      - SQL_SERVER_HOST=${SQL_SERVER_HOST:-localhost}
      - SQL_SERVER_PORT=${SQL_SERVER_PORT:-1433}
      - SQL_SERVER_DATABASE=${SQL_SERVER_DATABASE:-HR_Database}
      - SQL_SERVER_USERNAME=${SQL_SERVER_USERNAME:-sa}
      - SQL_SERVER_PASSWORD=${SQL_SERVER_PASSWORD:-}
      - SQL_SERVER_DRIVER=${SQL_SERVER_DRIVER:-ODBC Driver 17 for SQL Server}
      - SQL_SERVER_TIMEOUT=${SQL_SERVER_TIMEOUT:-30}
      - DEFAULT_EMPLOYEE_TABLE=${DEFAULT_EMPLOYEE_TABLE:-Employees}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/health/liveness')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - hr-network

networks:
  hr-network:
    driver: bridge

